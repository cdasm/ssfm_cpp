#include "bundleFunctionAndJacobian.h"



MatrixXd functionForRotationAndTransition(const MatrixXd& parameters,const MatrixXd& variables)
{
	double a,b,c,d,e,f,t1,t2,t3,r1,r2,r3;//% a b c coordinates of projpoints, d e f coordinates of points r1 r2 r3, rotation parameters t1 t2 t3 transition parameters
	a=parameters(0,0) ;
	b=parameters(0,1) ;
	c=parameters(0,2) ;
	d=parameters(0,3) ;
	e=parameters(0,4) ;
	f=parameters(0,5) ;

	r1=variables(0,0) ;
	r2=variables(0,1) ;
	r3=variables(0,2) ;
	t1=variables(0,3) ;
	t2=variables(0,4) ;
	t3=variables(0,5) ;

	
	MatrixXd A0(1,3);
	double t5 ,t6 ,t7 ,t8 ,t9 ,t10 ,t11 ,t12 ,t13 ,t14 ,t15 ,t16 ,t17 ,t18 ,t19 ,t20 ,t21 ,t22 ,t23 ,t24 ,t25 ;
	t5 = r1*r1;
	t6 = t5*(1.0/4.0);
	t7 = r2*r2;
	t8 = t7*(1.0/4.0);
	t9 = r3*r3;
	t10 = t9*(1.0/4.0);
	t11 = t6+t8+t10+1.0;
	t12 = 1.0/t11;
	t13 = d-t1;
	t14 = e-t2;
	t15 = f-t3;
	t16 = t13*t13;
	t17 = t14*t14;
	t18 = t15*t15;
	t19 = t16+t17+t18;
	t20 = 1.0/sqrt(t19);
	t21 = t6+t8+t10-1.0;
	t22 = r3*t12;
	t23 = r2*t12;
	t24 = r1*r3*t12*(1.0/2.0);
	t25 = r1*t12;
	A0(0,0) = -a+t13*t20*(t5*t12*(1.0/2.0)-t12*t21)+t15*t20*(t23+t24)-t14*t20*(t22-r1*r2*t12*(1.0/2.0));
	A0(0,1) = -b+t14*t20*(t7*t12*(1.0/2.0)-t12*t21)+t13*t20*(t22+r1*r2*t12*(1.0/2.0))-t15*t20*(t25-r2*r3*t12*(1.0/2.0));
	A0(0,2) = -c+t15*t20*(t9*t12*(1.0/2.0)-t12*t21)+t14*t20*(t25+r2*r3*t12*(1.0/2.0))-t13*t20*(t23-t24);
	return A0;
}



MatrixXd functionForRotationAndTransitionUnitLength(const MatrixXd& parameters,const MatrixXd& variables2)
{
	MatrixXd variable(1,6);
	variable.block(0,0,1,3)=variables2.block(0,0,1,3);
	variable.block(0,3,1,3)=transitionFrom2Para(variables2.block(0,3,1,2));

	return functionForRotationAndTransition(parameters,variable);
}




MatrixXd jacobianForPoint(const MatrixXd& parameters,const MatrixXd& variables)
{

	double a,b,c,d,e,f,t1,t2,t3,r1,r2,r3;
	a=parameters(0,0) ;
	b=parameters(0,1) ;
	c=parameters(0,2) ;
	d=parameters(0,3) ;
	e=parameters(0,4) ;
	f=parameters(0,5) ;

	r1=variables(0,0) ;
	r2=variables(0,1) ;
	r3=variables(0,2) ;
	t1=variables(0,3) ;
	t2=variables(0,4) ;
	t3=variables(0,5) ;
	MatrixXd A0(3,3);
	double t5 ,t6 ,t7 ,t8 ,t9 ,t10 ,t11 ,t12 ,t13 ,t14 ,t15 ,t16 ,t17 ,t18 ,t19 ,t20 ,t21 ,t22 ,t23 ,t24 ,t25 ,t26 ,t27 ,t28 ,t29 ,t30 ,t31 ,t32 ,t33 ,t34 ,t35 ,t36 ,t37 ,t38 ,t39 ,t40 ,t41 ,t42 ,t43 ,t44 ,t45 ,t46 ,t47 ,t48 ,t49 ,t50 ,t51 ,t52 ,t53 ,t54 ,t55 ,t56 ,t57 ,t58 ,t59 ,t60 ,t61 ,t62 ,t63 ,t64 ,t65 ,t66 ,t67 ,t68 ,t69 ,t70 ,t71 ,t72 ,t73 ,t74 ,t75 ,t76 ,t77 ,t78 ,t79 ,t80 ,t81 ,t82 ,t83 ,t84 ,t85 ,t86 ,t87 ,t88 ,t89 ,t90 ;
	t5 = d-t1;
	t6 = e-t2;
	t7 = f-t3;
	t8 = r1*r1;
	t9 = r2*r2;
	t10 = t2*t2;
	t11 = t3*t3;
	t12 = r3*r3;
	t13 = e*e;
	t14 = f*f;
	t15 = t5*t5;
	t16 = t6*t6;
	t17 = t7*t7;
	t18 = t15+t16+t17;
	t19 = 1.0/pow(t18,3.0/2.0);
	t20 = t8+t9+t12+4.0;
	t21 = 1.0/t20;
	t22 = d*d;
	t23 = t1*t1;
	t24 = d*e*4.0;
	t25 = t1*t2*4.0;
	t26 = r3*t14*4.0;
	t27 = r3*t11*4.0;
	t28 = d*t2*t9;
	t29 = d*t2*t12;
	t30 = e*t1*t9;
	t31 = e*t1*t12;
	t32 = t1*t2*t8;
	t33 = d*e*t8;
	t34 = f*r1*r2*t3*4.0;
	t35 = t8*t11;
	t36 = t14*4.0;
	t37 = t11*4.0;
	t38 = t8*t14;
	t39 = f*t3*t9*2.0;
	t40 = f*t3*t12*2.0;
	t41 = d*e*r3*4.0;
	t42 = r3*t1*t2*4.0;
	t43 = d*r1*r2*t2*2.0;
	t44 = e*r1*r2*t1*2.0;
	t45 = d*t3*4.0;
	t46 = f*t1*4.0;
	t47 = r2*t13*4.0;
	t48 = r2*t10*4.0;
	t49 = r1*r3*t13*2.0;
	t50 = d*t3*t8;
	t51 = f*t1*t8;
	t52 = r1*r3*t10*2.0;
	t53 = t1*t3*t9;
	t54 = t1*t3*t12;
	t55 = d*f*t9;
	t56 = d*f*t12;
	t57 = e*f*4.0;
	t58 = t2*t3*4.0;
	t59 = r1*t22*4.0;
	t60 = r1*t23*4.0;
	t61 = e*t3*t8;
	t62 = e*t3*t12;
	t63 = f*t2*t8;
	t64 = f*t2*t12;
	t65 = t2*t3*t9;
	t66 = e*f*t9;
	t67 = d*r2*r3*t1*4.0;
	t68 = t8*t10;
	t69 = t9*t23;
	t70 = t22*4.0;
	t71 = t13*4.0;
	t72 = t23*4.0;
	t73 = t10*4.0;
	t74 = t8*t22;
	t75 = t12*t22;
	t76 = t8*t13;
	t77 = d*t1*t9*2.0;
	t78 = e*t2*t9*2.0;
	t79 = e*t2*t12*2.0;
	t80 = d*r2*t3*4.0;
	t81 = e*r1*t3*4.0;
	t82 = f*r1*t2*4.0;
	t83 = f*r2*t1*4.0;
	t84 = e*f*r2*r3*2.0;
	t85 = d*r1*r3*t3*2.0;
	t86 = f*r1*r3*t1*2.0;
	t87 = r2*r3*t2*t3*2.0;
	t88 = d*t1*8.0;
	t89 = t8*t23;
	t90 = t12*t23;
	A0(0,0) = t19*t21*(t35+t36+t37+t38+t39+t40+t41+t42+t43+t44+t68+t71+t73+t76+t78+t79+t80+t83+t85+t86-e*t2*8.0-f*t3*8.0-t9*t10-t9*t11-t9*t13-t10*t12-t9*t14-t11*t12-t12*t13-t12*t14-d*f*r2*4.0-d*r3*t2*4.0-e*r3*t1*4.0-e*t2*t8*2.0-f*t3*t8*2.0-r2*t1*t3*4.0-d*e*r1*r2*2.0-d*f*r1*r3*2.0-r1*r2*t1*t2*2.0-r1*r3*t1*t3*2.0);
	A0(0,1) = -t19*t21*(t24+t25+t26+t27+t28+t29+t30+t31+t32+t33+t34-d*t2*4.0-e*t1*4.0+r3*t22*4.0+r3*t23*4.0+e*f*r2*4.0-d*e*t9-d*e*t12-d*r3*t1*8.0-e*r2*t3*4.0-f*r2*t2*4.0-f*r3*t3*8.0-d*t2*t8-e*t1*t8-r1*r2*t11*2.0-r1*r2*t14*2.0-r1*r2*t22*2.0-r1*r2*t23*2.0+r2*t2*t3*4.0-t1*t2*t9-t1*t2*t12+e*f*r1*r3*2.0+d*r1*r2*t1*4.0-e*r1*r3*t3*2.0-f*r1*r3*t2*2.0+r1*r3*t2*t3*2.0);
	A0(0,2) = t19*t21*(t45+t46+t47+t48+t49+t50+t51+t52+t53+t54+t55+t56-d*f*4.0+r2*t22*4.0+r2*t23*4.0-t1*t3*4.0+e*f*r3*4.0-d*f*t8-d*r2*t1*8.0-e*r2*t2*8.0-e*r3*t3*4.0-f*r3*t2*4.0-d*t3*t9-d*t3*t12-f*t1*t9-f*t1*t12+r1*r3*t22*2.0+r1*r3*t23*2.0+r3*t2*t3*4.0-t1*t3*t8-e*f*r1*r2*2.0-d*r1*r3*t1*4.0+e*r1*r2*t3*2.0-e*r1*r3*t2*4.0+f*r1*r2*t2*2.0-r1*r2*t2*t3*2.0);
	A0(1,0) = t19*t21*(-t24-t25+t26+t27+t28-t29+t30-t31+t32+t33-t34+d*t2*4.0+e*t1*4.0+r3*t10*4.0+r3*t13*4.0+d*f*r1*4.0-d*e*t9+d*e*t12-d*r1*t3*4.0-e*r3*t2*8.0-f*r1*t1*4.0-f*r3*t3*8.0-d*t2*t8-e*t1*t8+r1*r2*t10*2.0+r1*r2*t11*2.0+r1*r2*t13*2.0+r1*r2*t14*2.0+r1*t1*t3*4.0-t1*t2*t9+t1*t2*t12-d*f*r2*r3*2.0+d*r2*r3*t3*2.0-e*r1*r2*t2*4.0+f*r2*r3*t1*2.0-r2*r3*t1*t3*2.0);
	A0(1,1) = -t19*t21*(t35-t36-t37+t38+t39-t40+t41+t42-t43-t44-t69-t70-t72+t74+t75+t77+t81+t82+t84+t87+t88+t89+t90+f*t3*8.0-t9*t11-t9*t14+t11*t12+t12*t14-t9*t22-e*f*r1*4.0-d*r3*t2*4.0-e*r3*t1*4.0-d*t1*t8*2.0-d*t1*t12*2.0-f*t3*t8*2.0-r1*t2*t3*4.0+d*e*r1*r2*2.0-e*r2*r3*t3*2.0-f*r2*r3*t2*2.0+r1*r2*t1*t2*2.0);
	A0(1,2) = -t19*t21*(t57+t58+t59+t60+t61+t62+t63+t64+t65+t66+t67-e*t3*4.0-f*t2*4.0+r1*t10*4.0+r1*t13*4.0+d*f*r3*4.0-e*f*t8-e*f*t12-d*r1*t1*8.0-d*r3*t3*4.0-e*r1*t2*8.0-f*r3*t1*4.0-e*t3*t9-f*t2*t9-r2*r3*t10*2.0-r2*r3*t13*2.0-r2*r3*t22*2.0-r2*r3*t23*2.0+r3*t1*t3*4.0-t2*t3*t8-t2*t3*t12+d*f*r1*r2*2.0-d*r1*r2*t3*2.0+e*r2*r3*t2*4.0-f*r1*r2*t1*2.0+r1*r2*t1*t3*2.0);
	A0(2,0) = t19*t21*(t45+t46-t47-t48+t49-t50-t51+t52+t53-t54+t55-t56-d*f*4.0-r2*t11*4.0-r2*t14*4.0-t1*t3*4.0-d*e*r1*4.0+d*f*t8+d*r1*t2*4.0+e*r1*t1*4.0+e*r2*t2*8.0+f*r2*t3*8.0-d*t3*t9+d*t3*t12-f*t1*t9+f*t1*t12+r1*r3*t11*2.0+r1*r3*t14*2.0-r1*t1*t2*4.0+t1*t3*t8-d*e*r2*r3*2.0+d*r2*r3*t2*2.0-e*r1*r3*t2*4.0+e*r2*r3*t1*2.0-f*r1*r3*t3*4.0-r2*r3*t1*t2*2.0);
	A0(2,1) = t19*t21*(-t57-t58+t59+t60-t61+t62-t63+t64+t65+t66-t67+e*t3*4.0+f*t2*4.0+r1*t11*4.0+r1*t14*4.0+d*e*r2*4.0+e*f*t8-e*f*t12-d*r1*t1*8.0-d*r2*t2*4.0-e*r2*t1*4.0-f*r1*t3*8.0-e*t3*t9-f*t2*t9+r2*r3*t11*2.0+r2*r3*t14*2.0+r2*r3*t22*2.0+r2*r3*t23*2.0+r2*t1*t2*4.0+t2*t3*t8-t2*t3*t12-d*e*r1*r3*2.0+d*r1*r3*t2*2.0+e*r1*r3*t1*2.0-f*r2*r3*t3*4.0-r1*r3*t1*t2*2.0);
	A0(2,2) = -t19*t21*(t68+t69-t70-t71-t72-t73+t74-t75+t76-t77-t78+t79+t80-t81-t82+t83+t84-t85-t86+t87+t88+t89-t90+e*t2*8.0+t9*t10+t9*t13-t10*t12-t12*t13+t9*t22-d*f*r2*4.0+e*f*r1*4.0-d*t1*t8*2.0+d*t1*t12*2.0-e*t2*t8*2.0+r1*t2*t3*4.0-r2*t1*t3*4.0+d*f*r1*r3*2.0-e*r2*r3*t3*2.0-f*r2*r3*t2*2.0+r1*r3*t1*t3*2.0);

	return A0;
}



MatrixXd jacobianForPointUnitLength(const MatrixXd& parameters,const MatrixXd& variables)
{
	double a,b,c,d,e,f,t1,t2,r1,r2,r3;
	a=parameters(0,0) ;
	b=parameters(0,1) ;
	c=parameters(0,2) ;
	d=parameters(0,3) ;
	e=parameters(0,4) ;
	f=parameters(0,5) ;

	r1=variables(0,0) ;
	r2=variables(0,1) ;
	r3=variables(0,2) ;
	t1=variables(0,3) ;
	t2=variables(0,4) ;
	MatrixXd A0(3,3);
	double t4 ,t5 ,t6 ,t7 ,t8 ,t9 ,t10 ,t11 ,t13 ,t16 ,t19 ,t12 ,t17 ,t18 ,t14 ,t22 ,t15 ,t20 ,t21 ,t23 ,t24 ,t25 ,t28 ,t26 ,t27 ,t29 ,t30 ,t42 ,t31 ,t32 ,t35 ,t33 ,t34 ,t36 ,t37 ,t38 ,t39 ,t41 ,t40 ,t43 ,t44 ,t45 ,t46 ,t50 ,t47 ,t48 ,t51 ,t49 ,t52 ,t53 ,t55 ,t54 ;
	t4 = r1*r1;
	t5 = t4*(1.0/4.0);
	t6 = r2*r2;
	t7 = t6*(1.0/4.0);
	t8 = r3*r3;
	t9 = t8*(1.0/4.0);
	t10 = t5+t7+t9+1.0;
	t11 = 1.0/t10;
	t13 = cos(t1);
	t16 = cos(t2);
	t19 = t13*t16;
	t12 = d-t19;
	t17 = sin(t2);
	t18 = t13*t17;
	t14 = e-t18;
	t22 = sin(t1);
	t15 = f-t22;
	t20 = t12*t12;
	t21 = t14*t14;
	t23 = t15*t15;
	t24 = t20+t21+t23;
	t25 = d*2.0;
	t28 = t13*t16*2.0;
	t26 = t25-t28;
	t27 = 1.0/pow(t24,3.0/2.0);
	t29 = t4*t11*(1.0/2.0);
	t30 = t5+t7+t9-1.0;
	t42 = t11*t30;
	t31 = t29-t42;
	t32 = r3*t11;
	t35 = r1*r2*t11*(1.0/2.0);
	t33 = t32-t35;
	t34 = 1.0/sqrt(t24);
	t36 = r2*t11;
	t37 = r1*r3*t11*(1.0/2.0);
	t38 = t36+t37;
	t39 = e*2.0;
	t41 = t13*t17*2.0;
	t40 = t39-t41;
	t43 = f*2.0;
	t44 = t22*2.0;
	t45 = t43-t44;
	t46 = t32+t35;
	t50 = t6*t11*(1.0/2.0);
	t47 = t42-t50;
	t48 = r1*t11;
	t51 = r2*r3*t11*(1.0/2.0);
	t49 = t48-t51;
	t52 = t36-t37;
	t53 = t48+t51;
	t55 = t8*t11*(1.0/2.0);
	t54 = t42-t55;
	A0(0,0) = t31*t34-t12*t26*t27*t31*(1.0/2.0)+t14*t26*t27*t33*(1.0/2.0)-t15*t26*t27*t38*(1.0/2.0);
	A0(0,1) = -t33*t34-t12*t27*t31*t40*(1.0/2.0)+t14*t27*t33*t40*(1.0/2.0)-t15*t27*t38*t40*(1.0/2.0);
	A0(0,2) = t34*t38-t12*t27*t31*t45*(1.0/2.0)+t14*t27*t33*t45*(1.0/2.0)-t15*t27*t38*t45*(1.0/2.0);
	A0(1,0) = t34*t46-t12*t26*t27*t46*(1.0/2.0)+t14*t26*t27*t47*(1.0/2.0)+t15*t26*t27*t49*(1.0/2.0);
	A0(1,1) = -t34*t47-t12*t27*t40*t46*(1.0/2.0)+t15*t27*t40*t49*(1.0/2.0)+t14*t27*t40*(t42-t50)*(1.0/2.0);
	A0(1,2) = -t34*t49-t12*t27*t45*t46*(1.0/2.0)+t15*t27*t45*t49*(1.0/2.0)+t14*t27*t45*(t42-t50)*(1.0/2.0);
	A0(2,0) = -t34*t52+t12*t26*t27*t52*(1.0/2.0)-t14*t26*t27*t53*(1.0/2.0)+t15*t26*t27*t54*(1.0/2.0);
	A0(2,1) = t34*t53+t12*t27*t40*t52*(1.0/2.0)-t14*t27*t40*t53*(1.0/2.0)+t15*t27*t40*t54*(1.0/2.0);
	A0(2,2) = -t34*t54+t12*t27*t45*t52*(1.0/2.0)-t14*t27*t45*t53*(1.0/2.0)+t15*t27*t45*(t42-t55)*(1.0/2.0);

	return A0;
}	



MatrixXd jacobianForRotationAndTransition(const MatrixXd& parameters,const MatrixXd& variables)
{

	double a,b,c,d,e,f,t1,t2,t3,r1,r2,r3;
	a=parameters(0,0) ;
	b=parameters(0,1) ;
	c=parameters(0,2) ;
	d=parameters(0,3) ;
	e=parameters(0,4) ;
	f=parameters(0,5) ;

	r1=variables(0,0) ;
	r2=variables(0,1) ;
	r3=variables(0,2) ;
	t1=variables(0,3) ;
	t2=variables(0,4) ;
	t3=variables(0,5) ;

	MatrixXd A0(3,6);
	double t5 ,t6 ,t7 ,t8 ,t9 ,t10 ,t11 ,t12 ,t13 ,t14 ,t15 ,t16 ,t17 ,t18 ,t19 ,t20 ,t21 ,t22 ,t23 ,t24 ,t25 ,t26 ,t27 ,t28 ,t29 ,t30 ,t31 ,t32 ,t33 ,t34 ,t35 ,t36 ,t37 ,t38 ,t39 ,t40 ,t41 ,t42 ,t43 ,t44 ,t45 ,t46 ,t47 ,t48 ,t49 ,t50 ,t51 ,t52 ,t53 ,t54 ,t55 ,t56 ,t57 ,t58 ,t59 ,t60 ,t61 ,t62 ,t63 ,t64 ,t65 ,t66 ,t67 ,t68 ,t69 ,t70 ,t71 ,t72 ,t73 ,t74 ,t75 ,t76 ,t77 ,t78 ,t79 ,t80 ,t81 ,t82 ,t83 ,t84 ,t85 ,t86 ,t87 ,t88 ,t89 ,t90 ,t91 ,t92 ,t93 ,t94 ,t95 ,t96 ,t97 ,t98 ,t99 ,t100 ,t101 ,t102 ,t103 ,t104 ,t105 ,t106 ,t107 ,t108 ,t109 ,t110 ,t111 ,t112 ,t113 ,t114 ,t115 ,t116 ,t117 ,t118 ,t119 ,t120 ,t121 ,t122 ;
	t5 = d-t1;
	t6 = e-t2;
	t7 = f-t3;
	t8 = r2*r2;
	t9 = r3*r3;
	t10 = r1*r1;
	t11 = t5*t5;
	t12 = t6*t6;
	t13 = t7*t7;
	t14 = t11+t12+t13;
	t15 = 1.0/sqrt(t14);
	t16 = t8+t9+t10+4.0;
	t17 = 1.0/(t16*t16);
	t18 = t2*t2;
	t19 = t3*t3;
	t20 = e*e;
	t21 = f*f;
	t22 = 1.0/pow(t14,3.0/2.0);
	t23 = 1.0/t16;
	t24 = d*d;
	t25 = t1*t1;
	t26 = f*1.6E1;
	t27 = t3*1.6E1;
	t28 = f*t10*4.0;
	t29 = f*t9*4.0;
	t30 = t3*t8*4.0;
	t31 = r1*r2*r3*t3*4.0;
	t32 = f*r3*8.0;
	t33 = f*r3*t9*2.0;
	t34 = f*r3*t8*2.0;
	t35 = r3*t3*t10*2.0;
	t36 = r1*r2*t3*8.0;
	t37 = d*e*4.0;
	t38 = t1*t2*4.0;
	t39 = r3*t21*4.0;
	t40 = r3*t19*4.0;
	t41 = d*t2*t8;
	t42 = d*t2*t9;
	t43 = e*t1*t8;
	t44 = e*t1*t9;
	t45 = t1*t2*t10;
	t46 = d*e*t10;
	t47 = f*r1*r2*t3*4.0;
	t48 = t10*t19;
	t49 = t21*4.0;
	t50 = t19*4.0;
	t51 = t10*t21;
	t52 = f*t3*t8*2.0;
	t53 = f*t3*t9*2.0;
	t54 = d*e*r3*4.0;
	t55 = r3*t1*t2*4.0;
	t56 = d*r1*r2*t2*2.0;
	t57 = e*r1*r2*t1*2.0;
	t58 = e*1.6E1;
	t59 = t2*1.6E1;
	t60 = e*t10*4.0;
	t61 = e*t8*4.0;
	t62 = t2*t9*4.0;
	t63 = e*r1*r2*r3*4.0;
	t64 = d*1.6E1;
	t65 = t1*1.6E1;
	t66 = d*t10*4.0;
	t67 = d*t8*4.0;
	t68 = t1*t9*4.0;
	t69 = r1*r2*r3*t1*4.0;
	t70 = d*r1*8.0;
	t71 = e*r2*8.0;
	t72 = d*r1*t10*2.0;
	t73 = e*r2*t8*2.0;
	t74 = d*r1*t9*2.0;
	t75 = e*r2*t9*2.0;
	t76 = r1*t1*t8*2.0;
	t77 = r2*t2*t10*2.0;
	t78 = e*r1*r3*8.0;
	t79 = r2*r3*t1*8.0;
	t80 = d*t3*4.0;
	t81 = f*t1*4.0;
	t82 = r2*t20*4.0;
	t83 = r2*t18*4.0;
	t84 = r1*r3*t20*2.0;
	t85 = d*t3*t10;
	t86 = f*t1*t10;
	t87 = r1*r3*t18*2.0;
	t88 = t1*t3*t8;
	t89 = t1*t3*t9;
	t90 = d*f*t8;
	t91 = d*f*t9;
	t92 = e*f*4.0;
	t93 = t2*t3*4.0;
	t94 = r1*t24*4.0;
	t95 = r1*t25*4.0;
	t96 = e*t3*t10;
	t97 = e*t3*t9;
	t98 = f*t2*t10;
	t99 = f*t2*t9;
	t100 = t2*t3*t8;
	t101 = e*f*t8;
	t102 = d*r2*r3*t1*4.0;
	t103 = t10*t18;
	t104 = t8*t25;
	t105 = t24*4.0;
	t106 = t20*4.0;
	t107 = t25*4.0;
	t108 = t18*4.0;
	t109 = t10*t24;
	t110 = t9*t24;
	t111 = t10*t20;
	t112 = d*t1*t8*2.0;
	t113 = e*t2*t8*2.0;
	t114 = e*t2*t9*2.0;
	t115 = d*r2*t3*4.0;
	t116 = e*r1*t3*4.0;
	t117 = f*r1*t2*4.0;
	t118 = f*r2*t1*4.0;
	t119 = e*f*r2*r3*2.0;
	t120 = d*r1*r3*t3*2.0;
	t121 = f*r1*r3*t1*2.0;
	t122 = r2*r3*t2*t3*2.0;
	A0(0,0) = t15*t17*(t32+t33+t34+t35+t36+t71+t73+t75+t77+t78-r2*t2*8.0-r3*t3*8.0-f*r1*r2*8.0+d*r1*t8*4.0+d*r1*t9*4.0-e*r2*t10*2.0-f*r3*t10*2.0-r1*r3*t2*8.0-r1*t1*t8*4.0-r1*t1*t9*4.0-r2*t2*t8*2.0-r2*t2*t9*2.0-r3*t3*t8*2.0-r3*t3*t9*2.0);
	A0(0,1) = t15*t17*(t26-t27+t28+t29+t30+t31-d*r2*1.6E1+e*r1*8.0-f*t8*4.0-r1*t2*8.0+r2*t1*1.6E1-t3*t9*4.0-t3*t10*4.0+e*r2*r3*8.0-d*r2*t10*4.0-e*r1*t8*2.0+e*r1*t9*2.0+e*r1*t10*2.0-r2*r3*t2*8.0+r1*t2*t8*2.0-r1*t2*t9*2.0-r1*t2*t10*2.0+r2*t1*t10*4.0-f*r1*r2*r3*4.0);
	A0(0,2) = -t15*t17*(t58-t59+t60+t61+t62+t63+d*r3*1.6E1-f*r1*8.0-e*t9*4.0+r1*t3*8.0-r3*t1*1.6E1-t2*t8*4.0-t2*t10*4.0+f*r2*r3*8.0+d*r3*t10*4.0-f*r1*t8*2.0+f*r1*t9*2.0-f*r1*t10*2.0-r2*r3*t3*8.0+r1*t3*t8*2.0-r1*t3*t9*2.0+r1*t3*t10*2.0-r3*t1*t10*4.0-r1*r2*r3*t2*4.0);
	A0(0,3) = -t22*t23*(t48+t49+t50+t51+t52+t53+t54+t55+t56+t57+t103+t106+t108+t111+t113+t114+t115+t118+t120+t121-e*t2*8.0-f*t3*8.0-t8*t18-t8*t19-t9*t18-t8*t20-t9*t19-t8*t21-t9*t20-t9*t21-d*f*r2*4.0-d*r3*t2*4.0-e*r3*t1*4.0-e*t2*t10*2.0-f*t3*t10*2.0-r2*t1*t3*4.0-d*e*r1*r2*2.0-d*f*r1*r3*2.0-r1*r2*t1*t2*2.0-r1*r3*t1*t3*2.0);
	A0(0,4) = t22*t23*(t37+t38+t39+t40+t41+t42+t43+t44+t45+t46+t47-d*t2*4.0-e*t1*4.0+r3*t24*4.0+r3*t25*4.0+e*f*r2*4.0-d*e*t8-d*e*t9-d*r3*t1*8.0-e*r2*t3*4.0-f*r2*t2*4.0-f*r3*t3*8.0-d*t2*t10-e*t1*t10-r1*r2*t19*2.0-r1*r2*t21*2.0-r1*r2*t24*2.0-r1*r2*t25*2.0+r2*t2*t3*4.0-t1*t2*t8-t1*t2*t9+e*f*r1*r3*2.0+d*r1*r2*t1*4.0-e*r1*r3*t3*2.0-f*r1*r3*t2*2.0+r1*r3*t2*t3*2.0);
	A0(0,5) = -t22*t23*(t80+t81+t82+t83+t84+t85+t86+t87+t88+t89+t90+t91-d*f*4.0+r2*t24*4.0+r2*t25*4.0-t1*t3*4.0+e*f*r3*4.0-d*f*t10-d*r2*t1*8.0-e*r2*t2*8.0-e*r3*t3*4.0-f*r3*t2*4.0-d*t3*t8-d*t3*t9-f*t1*t8-f*t1*t9+r1*r3*t24*2.0+r1*r3*t25*2.0+r3*t2*t3*4.0-t1*t3*t10-e*f*r1*r2*2.0-d*r1*r3*t1*4.0+e*r1*r2*t3*2.0-e*r1*r3*t2*4.0+f*r1*r2*t2*2.0-r1*r2*t2*t3*2.0);
	A0(1,0) = -t15*t17*(t26-t27-t28+t29-t30-t31-d*r2*8.0+e*r1*1.6E1+f*t8*4.0-r1*t2*1.6E1+r2*t1*8.0-t3*t9*4.0+t3*t10*4.0+d*r1*r3*8.0-d*r2*t8*2.0-d*r2*t9*2.0+d*r2*t10*2.0+e*r1*t8*4.0-r1*r3*t1*8.0-r1*t2*t8*4.0+r2*t1*t8*2.0+r2*t1*t9*2.0-r2*t1*t10*2.0+f*r1*r2*r3*4.0);
	A0(1,1) = t15*t17*(t32+t33-t34-t35-t36+t70+t72+t74+t76+t79-r1*t1*8.0-r3*t3*8.0-d*r2*r3*8.0+f*r1*r2*8.0-d*r1*t8*2.0+e*r2*t9*4.0+e*r2*t10*4.0+f*r3*t10*2.0-r1*t1*t9*2.0-r1*t1*t10*2.0-r2*t2*t9*4.0-r2*t2*t10*4.0+r3*t3*t8*2.0-r3*t3*t9*2.0);
	A0(1,2) = t15*t17*(t64-t65+t66+t67+t68+t69-e*r3*1.6E1+f*r2*8.0-d*t9*4.0-r2*t3*8.0+r3*t2*1.6E1-t1*t8*4.0-t1*t10*4.0+f*r1*r3*8.0-e*r3*t8*4.0+f*r2*t8*2.0-f*r2*t9*2.0+f*r2*t10*2.0-r1*r3*t3*8.0-r2*t3*t8*2.0+r3*t2*t8*4.0+r2*t3*t9*2.0-r2*t3*t10*2.0-d*r1*r2*r3*4.0);
	A0(1,3) = -t22*t23*(-t37-t38+t39+t40+t41-t42+t43-t44+t45+t46-t47+d*t2*4.0+e*t1*4.0+r3*t18*4.0+r3*t20*4.0+d*f*r1*4.0-d*e*t8+d*e*t9-d*r1*t3*4.0-e*r3*t2*8.0-f*r1*t1*4.0-f*r3*t3*8.0-d*t2*t10-e*t1*t10+r1*r2*t18*2.0+r1*r2*t19*2.0+r1*r2*t20*2.0+r1*r2*t21*2.0+r1*t1*t3*4.0-t1*t2*t8+t1*t2*t9-d*f*r2*r3*2.0+d*r2*r3*t3*2.0-e*r1*r2*t2*4.0+f*r2*r3*t1*2.0-r2*r3*t1*t3*2.0);
	A0(1,4) = t22*t23*(t48-t49-t50+t51+t52-t53+t54+t55-t56-t57-t104-t105-t107+t109+t110+t112+t116+t117+t119+t122+d*t1*8.0+f*t3*8.0-t8*t19+t9*t19-t8*t21+t9*t21-t8*t24+t9*t25+t10*t25-e*f*r1*4.0-d*r3*t2*4.0-e*r3*t1*4.0-d*t1*t9*2.0-d*t1*t10*2.0-f*t3*t10*2.0-r1*t2*t3*4.0+d*e*r1*r2*2.0-e*r2*r3*t3*2.0-f*r2*r3*t2*2.0+r1*r2*t1*t2*2.0);
	A0(1,5) = t22*t23*(t92+t93+t94+t95+t96+t97+t98+t99+t100+t101+t102-e*t3*4.0-f*t2*4.0+r1*t18*4.0+r1*t20*4.0+d*f*r3*4.0-e*f*t9-e*f*t10-d*r1*t1*8.0-d*r3*t3*4.0-e*r1*t2*8.0-f*r3*t1*4.0-e*t3*t8-f*t2*t8-r2*r3*t18*2.0-r2*r3*t20*2.0-r2*r3*t24*2.0-r2*r3*t25*2.0+r3*t1*t3*4.0-t2*t3*t9-t2*t3*t10+d*f*r1*r2*2.0-d*r1*r2*t3*2.0+e*r2*r3*t2*4.0-f*r1*r2*t1*2.0+r1*r2*t1*t3*2.0);
	A0(2,0) = t15*t17*(t58-t59-t60+t61-t62-t63+d*r3*8.0-f*r1*1.6E1+e*t9*4.0+r1*t3*1.6E1-r3*t1*8.0-t2*t8*4.0+t2*t10*4.0+d*r1*r2*8.0+d*r3*t8*2.0+d*r3*t9*2.0-d*r3*t10*2.0-f*r1*t9*4.0-r1*r2*t1*8.0-r3*t1*t8*2.0+r1*t3*t9*4.0-r3*t1*t9*2.0+r3*t1*t10*2.0+r1*r2*r3*t2*4.0);
	A0(2,1) = -t15*t17*(t64-t65+t66-t67-t68-t69-e*r3*8.0+f*r2*1.6E1+d*t9*4.0-r2*t3*1.6E1+r3*t2*8.0+t1*t8*4.0-t1*t10*4.0+e*r1*r2*8.0+e*r3*t8*2.0-e*r3*t9*2.0-e*r3*t10*2.0+f*r2*t9*4.0-r1*r2*t2*8.0-r3*t2*t8*2.0-r2*t3*t9*4.0+r3*t2*t9*2.0+r3*t2*t10*2.0+d*r1*r2*r3*4.0);
	A0(2,2) = t15*t17*(t70+t71+t72+t73-t74-t75-t76-t77-t78-t79-r1*t1*8.0-r2*t2*8.0+d*r2*r3*8.0+d*r1*t8*2.0+e*r2*t10*2.0+f*r3*t8*4.0+f*r3*t10*4.0+r1*r3*t2*8.0+r1*t1*t9*2.0-r1*t1*t10*2.0-r2*t2*t8*2.0+r2*t2*t9*2.0-r3*t3*t8*4.0-r3*t3*t10*4.0);
	A0(2,3) = -t22*t23*(t80+t81-t82-t83+t84-t85-t86+t87+t88-t89+t90-t91-d*f*4.0-r2*t19*4.0-r2*t21*4.0-t1*t3*4.0-d*e*r1*4.0+d*f*t10+d*r1*t2*4.0+e*r1*t1*4.0+e*r2*t2*8.0+f*r2*t3*8.0-d*t3*t8+d*t3*t9-f*t1*t8+f*t1*t9+r1*r3*t19*2.0+r1*r3*t21*2.0-r1*t1*t2*4.0+t1*t3*t10-d*e*r2*r3*2.0+d*r2*r3*t2*2.0-e*r1*r3*t2*4.0+e*r2*r3*t1*2.0-f*r1*r3*t3*4.0-r2*r3*t1*t2*2.0);
	A0(2,4) = -t22*t23*(-t92-t93+t94+t95-t96+t97-t98+t99+t100+t101-t102+e*t3*4.0+f*t2*4.0+r1*t19*4.0+r1*t21*4.0+d*e*r2*4.0-e*f*t9+e*f*t10-d*r1*t1*8.0-d*r2*t2*4.0-e*r2*t1*4.0-f*r1*t3*8.0-e*t3*t8-f*t2*t8+r2*r3*t19*2.0+r2*r3*t21*2.0+r2*r3*t24*2.0+r2*r3*t25*2.0+r2*t1*t2*4.0-t2*t3*t9+t2*t3*t10-d*e*r1*r3*2.0+d*r1*r3*t2*2.0+e*r1*r3*t1*2.0-f*r2*r3*t3*4.0-r1*r3*t1*t2*2.0);
	A0(2,5) = t22*t23*(t103+t104-t105-t106-t107-t108+t109-t110+t111-t112-t113+t114+t115-t116-t117+t118+t119-t120-t121+t122+d*t1*8.0+e*t2*8.0+t8*t18-t9*t18+t8*t20-t9*t20+t8*t24-t9*t25+t10*t25-d*f*r2*4.0+e*f*r1*4.0+d*t1*t9*2.0-d*t1*t10*2.0-e*t2*t10*2.0+r1*t2*t3*4.0-r2*t1*t3*4.0+d*f*r1*r3*2.0-e*r2*r3*t3*2.0-f*r2*r3*t2*2.0+r1*r3*t1*t3*2.0);

	return A0;
}


MatrixXd jacobianForRotationAndTransitionUnitLength(const MatrixXd& parameters,const MatrixXd& variables)
{

	double a,b,c,d,e,f,t1,t2,r1,r2,r3;
	a=parameters(0,0) ;
	b=parameters(0,1) ;
	c=parameters(0,2) ;
	d=parameters(0,3) ;
	e=parameters(0,4) ;
	f=parameters(0,5) ;

	r1=variables(0,0) ;
	r2=variables(0,1) ;
	r3=variables(0,2) ;
	t1=variables(0,3) ;
	t2=variables(0,4) ;
	//t3=variables(0,5) ;
	MatrixXd A0(3,5);
	double t4 ,t5 ,t6 ,t7 ,t8 ,t9 ,t10 ,t11 ,t13 ,t17 ,t18 ,t12 ,t21 ,t22 ,t14 ,t15 ,t16 ,t19 ,t20 ,t23 ,t24 ,t25 ,t26 ,t27 ,t28 ,t29 ,t30 ,t31 ,t32 ,t33 ,t34 ,t35 ,t36 ,t37 ,t38 ,t44 ,t39 ,t40 ,t45 ,t41 ,t42 ,t46 ,t43 ,t47 ,t48 ,t49 ,t50 ,t51 ,t52 ,t53 ,t58 ,t54 ,t55 ,t59 ,t56 ,t57 ,t61 ,t60 ,t62 ,t63 ,t64 ,t65 ,t66 ,t67 ,t68 ,t69 ;
	t4 = r1*r1;
	t5 = t4*(1.0/4.0);
	t6 = r2*r2;
	t7 = t6*(1.0/4.0);
	t8 = r3*r3;
	t9 = t8*(1.0/4.0);
	t10 = t5+t7+t9+1.0;
	t11 = 1.0/(t10*t10);
	t13 = cos(t1);
	t17 = cos(t2);
	t18 = t13*t17;
	t12 = d-t18;
	t21 = sin(t2);
	t22 = t13*t21;
	t14 = e-t22;
	t15 = sin(t1);
	t16 = f-t15;
	t19 = 1.0/t10;
	t20 = t12*t12;
	t23 = t14*t14;
	t24 = t16*t16;
	t25 = t20+t23+t24;
	t26 = 1.0/sqrt(t25);
	t27 = r2*t19*(1.0/2.0);
	t28 = t5+t7+t9-1.0;
	t29 = r1*t19*(1.0/2.0);
	t30 = r2*r3*t11*(1.0/2.0);
	t31 = r1*r2*r3*t11*(1.0/4.0);
	t32 = r3*t4*t11*(1.0/4.0);
	t33 = r2*t19;
	t34 = r1*r3*t19*(1.0/2.0);
	t35 = t33+t34;
	t36 = 1.0/pow(t25,3.0/2.0);
	t37 = t14*t15*t21*2.0;
	t38 = t12*t15*t17*2.0;
	t44 = t13*t16*2.0;
	t39 = t37+t38-t44;
	t40 = r3*t19;
	t45 = r1*r2*t19*(1.0/2.0);
	t41 = t40-t45;
	t42 = t4*t19*(1.0/2.0);
	t46 = t19*t28;
	t43 = t42-t46;
	t47 = t13*t14*t17*2.0;
	t48 = r1*t11*t28*(1.0/2.0);
	t49 = r1*r3*t11*(1.0/2.0);
	t50 = r2*t4*t11*(1.0/4.0);
	t51 = r3*t19*(1.0/2.0);
	t52 = r1*r2*t11*(1.0/2.0);
	t53 = r1*t6*t11*(1.0/4.0);
	t58 = t6*t19*(1.0/2.0);
	t54 = t46-t58;
	t55 = r1*t19;
	t59 = r2*r3*t19*(1.0/2.0);
	t56 = t55-t59;
	t57 = t40+t45;
	t61 = t12*t13*t21*2.0;
	t60 = t47-t61;
	t62 = r1*t8*t11*(1.0/4.0);
	t63 = t6*t11*(1.0/2.0);
	t64 = r2*t11*t28*(1.0/2.0);
	t65 = r3*t6*t11*(1.0/4.0);
	t66 = r2*t8*t11*(1.0/4.0);
	t67 = t33-t34;
	t68 = t55+t59;
	t69 = t46-t8*t19*(1.0/2.0);
	A0(0,0) = t12*t26*(t29+t48-r1*t4*t11*(1.0/4.0))+t14*t26*(t27+t49-r2*t4*t11*(1.0/4.0))-t16*t26*(t32+t52-r3*t19*(1.0/2.0));
	A0(0,1) = t14*t26*(t29+t30-r1*t6*t11*(1.0/4.0))-t12*t26*(t27+t50-r2*t11*t28*(1.0/2.0))-t16*t26*(-t19+t31+t63);
	A0(0,2) = -t12*t26*(t32+t51-r3*t11*t28*(1.0/2.0))-t16*t26*(-t29+t30+t62)-t14*t26*(t19+t31-t8*t11*(1.0/2.0));
	A0(0,3) = -t13*t26*t35+t15*t17*t26*t43-t15*t21*t26*t41-t16*t35*t36*t39*(1.0/2.0)-t12*t36*t39*t43*(1.0/2.0)+t14*t36*t39*t41*(1.0/2.0);
	A0(0,4) = t13*t17*t26*t41+t13*t21*t26*t43+t16*t35*t36*t60*(1.0/2.0)+t12*t36*t43*t60*(1.0/2.0)-t14*t36*t41*t60*(1.0/2.0);
	A0(1,0) = -t12*t26*(-t27+t49+t50)-t14*t26*(t29-t48+t53)-t16*t26*(t19+t31-t4*t11*(1.0/2.0));
	A0(1,1) = t14*t26*(t27+t64-r2*t6*t11*(1.0/4.0))+t16*t26*(t51+t52-r3*t6*t11*(1.0/4.0))-t12*t26*(-t29+t30+t53);
	A0(1,2) = -t12*t26*(-t19+t31+t8*t11*(1.0/2.0))+t16*t26*(t27+t49-r2*t8*t11*(1.0/4.0))-t14*t26*(t51+t65-r3*t11*t28*(1.0/2.0));
	A0(1,3) = t13*t26*t56+t15*t17*t26*t57-t15*t21*t26*t54+t14*t36*t39*t54*(1.0/2.0)-t12*t36*t39*t57*(1.0/2.0)+t16*t36*t39*t56*(1.0/2.0);
	A0(1,4) = t13*t21*t26*t57-t14*t36*t54*t60*(1.0/2.0)+t12*t36*t57*t60*(1.0/2.0)-t16*t36*t56*t60*(1.0/2.0)+t13*t17*t26*(t46-t58);
	A0(2,0) = -t14*t26*(-t19+t31+t4*t11*(1.0/2.0))+t12*t26*(-t32+t51+t52)-t16*t26*(t29-t48+t62);
	A0(2,1) = -t12*t26*(t19+t31-t63)-t16*t26*(t27-t64+t66)-t14*t26*(-t51+t52+t65);
	A0(2,2) = t12*t26*(t29+t30-t62)-t14*t26*(-t27+t49+t66)+t16*t26*(t51-r3*t8*t11*(1.0/4.0)+r3*t11*t28*(1.0/2.0));
	A0(2,3) = t13*t26*t69-t15*t17*t26*t67+t15*t21*t26*t68+t12*t36*t39*t67*(1.0/2.0)-t14*t36*t39*t68*(1.0/2.0)+t16*t36*t39*t69*(1.0/2.0);
	A0(2,4) = -t13*t17*t26*t68-t13*t21*t26*t67-t12*t36*t60*t67*(1.0/2.0)-t16*t36*t60*t69*(1.0/2.0)+t14*t36*t68*(t47-t61)*(1.0/2.0);


	return A0;
}

